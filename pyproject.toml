[tool.poetry]
name = "education-backend"
version = "2023.10.20"
description = ""
authors = ["Fedor Borshev <fedor@borshev.com>"]
readme = "README.md"

[tool.poetry.dependencies]
python = "^3.11"
babel = "^2.12.1"
bcrypt = "^4.0.1"
bleach = "^6.0.0"
boto3 = "^1.28.48"
celery = "^5.3.4"
cmarkgfm = "^2022.10.27"
django = "^4.2.5"
djangorestframework = "^3.14.0"
django-anymail = "^10.1"
django-axes = "^6.1.1"
django-behaviors = "^0.5.1"
django-cachalot = "^2.6.1"
django-cors-headers = "^4.2.0"
django-debug-toolbar = "^4.2.0"
django-environ = "^0.11.2"
django-filter = "^23.2"
django-healthchecks = "^1.5.0"
django-ipware = "^5.0.0"
django-prettyjson = "^0.4.1"
django-split-settings = "^1.2.0"
django-storages = "^1.14"
django-tree-queries = "^0.15.0"
dj-rest-auth = "^5.0.0"
drf-jwt = "^1.19.2"
drf-recaptcha = "^3.0.0"
drf-spectacular = {extras = ["sidecar"], version = "^0.26.4"}
emoji = "^2.8.0"
httpx = {extras = ["http2"], version = "^0.25.0"}
pillow = "^10.0.1"
psycopg2-binary = "^2.9.7"
redis = "^5.0.0"
retry = "^0.9.2"
sentry-sdk = "^1.31.0"
shortuuid = "^1.0.11"
simplejson = "^3.19.1"
stripe = "^6.5.0"
whitenoise = "^6.5.0"

[tool.poetry.group.dev.dependencies]
autoflake = "^2.2.1"
black = "^23.9.1"

flake8-absolute-import = "^1.0.0.1"
flake8-black = "^0.3.6"
flake8-bugbear = "^23.7.10"
flake8-cognitive-complexity = "^0.1.0"
flake8-django = "^1.4"
flake8-eradicate = "^1.5.0"
flake8-fixme = "^1.1.1"
flake8-isort = "^6.0.0"
flake8-multiline-containers = "^0.0.19"
flake8-mutable = "^1.2.0"
flake8-pep3101 = "^2.0.0"
flake8-pie = "^0.16.0"
flake8-print = "^5.0.0"
flake8-printf-formatting = "^1.1.2"
flake8-pyproject = "^1.2.3"
flake8-pytest = "^1.4"
flake8-pytest-style = "^1.7.2"
flake8-simplify = "^0.20.0"
flake8-tidy-imports = "^4.10.0"
flake8-todo = "^0.7"
flake8-use-fstring = "^1.4"
flake8-variables-names = "^0.0.6"
flake8-walrus = "^1.2.0"

freezegun = "^1.2.2"
ipython = "^8.15.0"
jedi = "^0.19.0"
mixer = "^7.2.2"
mypy = "^1.5.1"
pytest-django = "^4.5.2"
pytest-cov = "^4.1.0"
pytest-deadfixtures = "^2.2.1"
pytest-env = "^1.0.1"
pytest-freezegun = "^0.4.2"
pytest-mock = "^3.11.1"
pytest-randomly = "^3.15.0"
pytest-repeat = "^0.9.1"
pytest-xdist = "^3.3.1"
requests-mock = "^1.11.0"
respx = "^0.20.2"

boto3-stubs = "^1.28.48"
djangorestframework-stubs = "^3.14.2"
django-stubs = "^4.2.4"
types-babel = "^2.11.0.15"
types-bleach = "^6.0.0.4"
types-freezegun = "^1.1.10"
types-markdown = "^3.4.2.10"
types-pillow = "^10.0.0.3"
types-requests = "^2.31.0.2"
types-retry = "^0.9.9.4"
types-simplejson = "^3.19.0.2"
types-stripe = "^3.5.2.14"

[tool.black]
exclude = """
/(
    | migrations
)/
"""
line_length = 160

[tool.flake8]
banned-modules = """
    typing.Optional = Please use "x | None"
    typing.Union = Please use "x | y"
    typing.List = Please use "list" instead of "List"
    typing.Dict = Please use "dict" instead of "Dict"
"""
exclude = [
    "frontend",
    "migrations",
    "static",
    ".git",
    "__pycache__",
]
ignore = [
    "DJ01",     # avoid using null=True on string-based fields such CharField
    "DJ07",     # do not use __all__ with ModelForm, use fields instead
    "DJ08",     # model does not define __str__ method
    "E501",     # line too long ({} > {} characters)
    "PIE783",   # celery tasks should have explicit names
    "PIE785",   # celery tasks should have expirations
    "PIE801",   # prefer-simple-return: Return boolean expressions directly instead of returning `True` and `False`
    "PT001",    # use @pytest.fixture() over @pytest.fixture
    "SIM102",   # use a single if-statement instead of nested if-statements
    "SIM113",   # use enumerate for `{}`
    "VNE003",   # variable names that shadow builtins are not allowed
    "W503",     # line break before binary operator
]
line-quotes = "\""

[tool.isort]
extra_standard_library = ["pytest"]
known_django = ["django", "restframework"]
line_length = 160
multi_line_output = 3
profile = "google"
sections = ["FUTURE", "STDLIB", "THIRDPARTY", "DJANGO", "FIRSTPARTY", "LOCALFOLDER"]
use_parentheses = true

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"

[tool.pytest.ini_options]
pythonpath = ". src"
DJANGO_SETTINGS_MODULE = "app.settings"
python_files = "test*.py"
addopts = "--reuse-db"
markers = [
    "freeze_time: freezing time marker (pytest-freezegun does not register it)",
    "single_thread: marked tests should be ran only in single thread",
    "slow: tests with inentional slow run"
]

filterwarnings = [
    "error",
    "ignore:unclosed file:ResourceWarning",
    "ignore:'cgi' is deprecated",
    "ignore:pkg_resources is deprecated as an API",
    "ignore:SelectableGroups dict interface is deprecated",
    "ignore:distutils Version classes are deprecated. Use packaging.version instead.:DeprecationWarning:pytest_freezegun:17"
]

env = [
    "CI = 1",
    "CELERY_ALWAYS_EAGER = True",
    "AWS_ACCESS_KEY_ID = zeroc00l94",
    "AWS_SECRET_ACCESS_KEY = h4xx0r",
    "AWS_STORAGE_BUCKET_NAME = pwned_data",
    "AWS_S3_REGION_NAME = Ukraine",
    "AWS_S3_ENDPOINT_URL = https://fra1.digitaloceanspaces.com",
    "RECAPTCHA_ENABLED = Off",
    "DISABLE_THROTTLING = On",
    "DEFAULT_FILE_STORAGE = django.core.files.storage.FileSystemStorage",
    "DISABLE_HOMEWORK_PERMISSIONS_CHECKING = On",
    "JWT_PUBLIC_KEY = -----BEGIN PUBLIC KEY-----\r\nMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAw0GNtyb/b2dQ4R8yPbmV\r\neAKMprJlQoRbjtWch6bGhnxyGYBSuowPPUQZxBC8EE6ZsS5O4rbIPKzn8jZLNqpt\r\n2jJ5upLcGO9Eo+/5C5FNqAHRsrms6J7rK3ReafmdwO9ZIoYHgCPhw2Yo4yf6jCsC\r\nUupabwt2HPLf7oGzQWLwjKNnhVlOfl9MoXOH1k4v2P34IDI8gWyXI/wk7h+FJTZe\r\nG+ZCbol4r8dSCz1+5mKbtDmgDNRXzXBEc223RWLoAmRfLYf7taPpbxGmigWBaiT8\r\nEPIJh9lC5Zx9sXFxScC4JbsDb64cI42B0QyWNE/oApKuXSdUZhtQQudB4KL6tW+w\r\nl74uiTsTjkPxHd5sd6aJNgmEOnL28/CKfg9FePel3PRMUgwl1HlwQmj8X5pOfF1R\r\n1qNXDkg6J3rBSk1uz/peDxlpLHgUPZmJWHCcmubmvvuMbHKBbP9KxVV0ZJD0ozYZ\r\ni7gAsfEFcqHmCZBtCGSJOZjrLWd0U4+5m25iyBrK9+uNzotguXFhUcJXVd4ORpfo\r\npvO8BcELskJKORWNxx5zKgJxHqLFbq+QoebczfgqkeA9ynFbXOtgw6OKnXnasnYP\r\nA6IiiMIKHyck2owAJyOH0wFO2lM7I7t7KrWBTD+Esm/Zu7V16nCMQaz0/Vqjz2/G\r\nk0TeBTUnTFZOWU17yJvcw9cCAwEAAQ==\r\n-----END PUBLIC KEY-----",
    "JWT_PRIVATE_KEY = -----BEGIN RSA PRIVATE KEY-----\r\n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\r\n-----END RSA PRIVATE KEY-----",
    "DISABLE_NEW_ANSWER_NOTIFICATIONS = On",
    "ATOL_WEBHOOK_SALT = SECRET-SALT",
    "REDISCLOUD_URL=redis://localhost",
    "DATABASE_URL=postgres://postgres:secret@localhost:5432/postgres",
    "CELERY_BROKER_URL=redis://localhost",
]
